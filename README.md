# terraform-aws-apigateway-vpclink-account

This is just a trivial little lookup table, because I didn't want to continue recreating it. It comes from [API Gateway accounts used for private integrations](https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-api-with-vpclink-accounts.html).

The use case is, one wants to use the VPC Endpoint Service created automatically when a VPC Link is created for private API Gateway integrations. If you need to change it in terraform, you must import the resource. You can choose to ignore changes to `allowed_principals`, but if you intend to manage this attribute, you must include this account in the list.

## Usage

```terraform
locals {
  region = "eu-west-1"
}

module "vpclink_account" {
  source = "theherk/apigateway-vpclink-account/aws"

  region = local.region
}

resource "aws_vpc_endpoint_service" "nlb" {
  acceptance_required        = false
  network_load_balancer_arns = [module.lb.nlb.arn]

  allowed_principals = [
    module.vpclink_account.arn,      # https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-api-with-vpclink-accounts.html
    "arn:aws:iam::123412341234:root" # other account
  ]

  # We must explicitly force the VPC Link to be created first.
  # This ensures that the VPC Endpoint Service is created by AWS because
  # we cannot create the link with an existing service. Therefore, this
  # will fail, as expected, and then must be imported.
  depends_on = [aws_api_gateway_vpc_link.nlb]
}

```

## Contributing

To work on this repository, you need to install the [pre-commit](https://github.com/pre-commit/pre-commit) hooks, and dependencies from [pre-commit-terraform](https://github.com/antonbabenko/pre-commit-terraform).

    make pre-commit

That should be the easy way, but if you use another package manager than `apt`, `brew`, or `yum` or want to configure these differently on your system, you can do so by following the guidance [here](https://github.com/antonbabenko/pre-commit-terraform#1-install-dependencies). For instance, you can set this up to use docker for running checks rather than installing directly to your filesystem.

After doing this, several checks will be run when attempting commits.

---

_note_: The following is generated by `terraform docs`.

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 0.15 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 3.64 |

## Providers

No providers.

## Modules

No modules.

## Resources

No resources.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_region"></a> [region](#input\_region) | Region of private API integration account. | `string` | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_account"></a> [account](#output\_account) | Account automatically added to your VPC endpoint service as AllowedPrincipals when you create a vpclink. |
| <a name="output_arn"></a> [arn](#output\_arn) | The account arn, given as `arn:aws:iam::123412341234:root`. |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
